from sqlalchemy.orm import Session
import app.models as models
import app.schemas as schemas
import app.crud.connector as connector


def get_by_id(db: Session, id: int):
    return db.query(models.Infrastructure).filter(models.Infrastructure.id == id).first()


def get_all(db: Session):
    Infrastructures = db.query(models.Infrastructure).all()
    infrastructures = []
    for inf in Infrastructures:
        p = {}
        p["id"] = inf.id
        p["total"] = inf.total
        p["date"] = inf.date
        p["target"] = inf.target
        p["high"] = inf.high
        p["medium"] = inf.medium
        p["low"] = inf.low
        p["connector"] = connector.get_by_id(db, inf.idc).name
        infrastructures.append(p)
    return infrastructures


def delete(db: Session, id: int):
    Infrastructure = db.query(models.Infrastructure).filter(
        models.Infrastructure.id == id).first()
    db.delete(Infrastructure)
    db.commit()


def create(db: Session, Infrastructure: schemas.Infrastructure):
    Infrastructure = models.Infrastructure(target=Infrastructure.target, date=Infrastructure.date, total=Infrastructure.total,
                                           high=Infrastructure.high, medium=Infrastructure.high, low=Infrastructure.low, idp=Infrastructure.idp, idc=Infrastructure.idc)
    db.add(Infrastructure)
    db.commit()
